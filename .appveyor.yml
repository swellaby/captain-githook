skip_branch_with_pr: true
build: off
version: "{build}"
branches:
  only:
    - master

cache:
  - c:\users\appveyor\go -> go.mod, go.sum, scripts\setup.go

install:
  - ps: $env:GOBIN = "$(go env GOPATH)\bin"
  - ps: $env:PATH += ";$($env:GOBIN);"
  - go run .\scripts\setup.go
  - go get -u github.com/magefile/mage

test_script:
  - mage test
  - task ci

after_test:
  - ps: (New-Object 'System.Net.WebClient').UploadFile("https://ci.appveyor.com/api/testresults/junit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\.testresults\junit2.xml))
